---
import { getEntry, getCollection, render } from 'astro:content';
import MarkdownLayout from '../../layouts/MarkdownLayout.astro';

export async function getStaticPaths() {
  const entries = await getCollection('books');
  const paths = entries
    .filter((e) => !e.data.draft)
    .map((entry) => {
      const slug = entry.id.replace(/\.mdx?$/, '');
      console.log(`Generating path for entry.id: ${entry.id} -> slug: ${slug}`);
      return { params: { slug } };
    });
  console.log('Generated paths:', paths);
  return paths;
}

const { slug } = Astro.params;
// The slug now includes the language prefix (e.g., "de/licht-am-ende-der-zeilen")
const entry = await getEntry('books', slug);
if (!entry) throw new Error(`Book not found: ${slug}`);

const { Content } = await render(entry);
---

<MarkdownLayout frontmatter={entry.data}>
  <Content />
</MarkdownLayout>
