---
import { getEntry, getCollection, render } from 'astro:content';
import MarkdownLayout from '../../../layouts/MarkdownLayout.astro';

export async function getStaticPaths() {
  const entries = await getCollection('books');
  return entries
    .filter(e => !e.data.draft && e.data.language === 'de')
    .map(entry => ({
      params: { slug: entry.id.replace('de/', '').replace(/\.mdx?$/, '') }
    }));
}

const { slug } = Astro.params;
const entry = await getEntry('books', `de/${slug}`);
if (!entry) throw new Error(`Book not found: de/${slug}`);

const { Content } = await render(entry);
---
<MarkdownLayout frontmatter={entry.data}>
  <Content />
</MarkdownLayout>
